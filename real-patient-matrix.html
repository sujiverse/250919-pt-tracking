<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ ì‹¤ì œ í™˜ì ì¶”ì  ë§¤íŠ¸ë¦­ìŠ¤ (9ì›”)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0 0 5px 0;
            font-size: 22px;
        }

        .header .subtitle {
            margin: 0 0 10px 0;
            font-size: 13px;
            opacity: 0.9;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            font-size: 11px;
        }

        .controls {
            background: white;
            padding: 8px 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-input {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            width: 120px;
        }

        .container {
            height: calc(100vh - 120px);
            display: flex;
            overflow: hidden;
        }

        /* í™˜ìëª… ê³ ì • ì—´ */
        .patient-column {
            width: 100px;
            background: white;
            border-right: 2px solid #ddd;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .patient-header {
            height: 40px;
            background: #343a40;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
            position: sticky;
            top: 0;
            z-index: 15;
        }

        .patient-cell {
            height: 35px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 10px;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            position: relative;
        }

        .patient-cell:hover {
            background: #f8f9fa;
        }

        .patient-cell.frequent {
            border-left: 4px solid #28a745;
            background: #f8fff9;
        }

        /* ë°ì´í„° ìŠ¤í¬ë¡¤ ì˜ì—­ */
        .data-scroll {
            flex: 1;
            overflow: auto;
        }

        .data-grid {
            display: inline-block;
            min-width: fit-content;
        }

        /* ë‚ ì§œ í—¤ë” */
        .date-header {
            display: flex;
            height: 40px;
            position: sticky;
            top: 0;
            z-index: 5;
            background: white;
            border-bottom: 2px solid #ddd;
        }

        .date-cell {
            width: 90px;
            min-width: 90px;
            border-right: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            font-weight: bold;
            font-size: 10px;
            color: #495057;
        }

        .date-cell:hover {
            background: #e9ecef;
        }

        /* í™˜ìë³„ ë°ì´í„° í–‰ */
        .patient-row {
            display: flex;
            height: 35px;
            border-bottom: 1px solid #e9ecef;
        }

        .treatment-cell {
            width: 90px;
            min-width: 90px;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            cursor: pointer;
            position: relative;
            padding: 2px;
        }

        .treatment-cell:hover {
            transform: scale(1.05);
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .treatment-cell.empty {
            background: #ffffff;
        }

        .treatment-cell.empty:hover {
            background: #f8f9fa;
        }

        /* ì¹˜ë£Œì‚¬ë³„ ìƒ‰ê¹” */
        .ì¹˜ë£Œì‚¬A { background: #ffe5e5; color: #c92a2a; border: 1px solid #ff9999; }
        .ì¹˜ë£Œì‚¬B { background: #e5f3ff; color: #1971c2; border: 1px solid #99ccff; }
        .ì¹˜ë£Œì‚¬C { background: #e5ffe5; color: #2f9e44; border: 1px solid #99ff99; }
        .ì¹˜ë£Œì‚¬D { background: #fff5e5; color: #e8590c; border: 1px solid #ffcc99; }
        .ì¹˜ë£Œì‚¬E { background: #f3e5ff; color: #7950f2; border: 1px solid #cc99ff; }
        .íŠ¹ë³„ì¹˜ë£Œì‚¬ { background: #e5ffff; color: #0ca678; border: 1px solid #99ffff; }
        .ë¯¸ì • { background: #f5f5f5; color: #666; border: 1px solid #ccc; }

        .first-visit {
            position: relative;
        }

        .first-visit::after {
            content: "â­";
            position: absolute;
            top: 1px;
            right: 2px;
            font-size: 8px;
            color: #ffc107;
        }

        .treatment-text {
            text-align: center;
            line-height: 1.1;
            font-weight: bold;
        }

        .time-text {
            font-size: 7px;
            color: #666;
            margin-top: 1px;
        }

        /* ë²”ë¡€ */
        .legend {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: white;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 250px;
            overflow-y: auto;
        }

        .legend div {
            margin: 1px 0;
            padding: 1px 6px;
            border-radius: 2px;
        }

        .legend .section {
            font-weight: bold;
            margin-top: 5px;
            border-bottom: 1px solid #eee;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .patient-column { width: 80px; }
            .date-cell, .treatment-cell { width: 70px; min-width: 70px; }
            .filter-input { width: 80px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¥ ì‹¤ì œ í™˜ì ì¶”ì  ë§¤íŠ¸ë¦­ìŠ¤</h1>
        <p class="subtitle">2025ë…„ 9ì›” ì‹¤ì œ ì¹˜ë£Œ ë°ì´í„° â€¢ í™˜ìë³„ ì¤‘ë³µ ë°©ë¬¸ ì¶”ì </p>
        <div class="stats">
            <span id="patientCount">í™˜ì: 24ëª…</span>
            <span id="dateRange">ê¸°ê°„: 09/01~09/22</span>
            <span id="treatmentCount">ì¹˜ë£Œ: 56ê±´</span>
            <span id="frequentCount">ë‹¤íšŒë°©ë¬¸: 7ëª…</span>
        </div>
    </div>

    <div class="controls">
        <div class="filter-group">
            <input type="text" id="patientFilter" class="filter-input" placeholder="í™˜ìëª… ê²€ìƒ‰..." onkeyup="filterPatients()">
            <select id="therapistFilter" class="filter-input" onchange="filterPatients()">
                <option value="">ì „ì²´ ì¹˜ë£Œì‚¬</option>
                <option value="ì¹˜ë£Œì‚¬A">ì¹˜ë£Œì‚¬A</option>
                <option value="ì¹˜ë£Œì‚¬B">ì¹˜ë£Œì‚¬B</option>
                <option value="ì¹˜ë£Œì‚¬C">ì¹˜ë£Œì‚¬C</option>
                <option value="íŠ¹ë³„ì¹˜ë£Œì‚¬">íŠ¹ë³„ì¹˜ë£Œì‚¬</option>
            </select>
        </div>
        <div class="filter-group">
            <label>
                <input type="checkbox" id="frequentOnly" onchange="filterPatients()"> ë‹¤íšŒë°©ë¬¸ë§Œ (3íšŒ+)
            </label>
            <label>
                <input type="checkbox" id="firstVisitOnly" onchange="filterPatients()"> ì²«ë‚´ì›ë§Œ
            </label>
            <span style="margin-left: 15px; font-size: 11px; color: #666;">
                ì¢Œìš° í™”ì‚´í‘œ: ìŠ¤í¬ë¡¤ | í™˜ìëª… í´ë¦­: í•˜ì´ë¼ì´íŠ¸
            </span>
        </div>
    </div>

    <div class="container">
        <!-- í™˜ìëª… ê³ ì • ì—´ -->
        <div class="patient-column">
            <div class="patient-header">í™˜ìëª…</div>
            <div id="patient-list">
                <!-- JavaScriptë¡œ ìƒì„± -->
            </div>
        </div>

        <!-- ë°ì´í„° ìŠ¤í¬ë¡¤ ì˜ì—­ -->
        <div class="data-scroll" id="dataScroll">
            <div class="data-grid">
                <!-- ë‚ ì§œ í—¤ë” -->
                <div class="date-header" id="dateHeader">
                    <!-- JavaScriptë¡œ ìƒì„± -->
                </div>

                <!-- í™˜ìë³„ ë°ì´í„° í–‰ë“¤ -->
                <div id="patientRows">
                    <!-- JavaScriptë¡œ ìƒì„± -->
                </div>
            </div>
        </div>
    </div>

    <!-- ì¹˜ë£Œì‚¬ë³„ ìƒ‰ê¹” ë²”ë¡€ -->
    <div class="legend">
        <div class="section">ğŸ‘©â€âš•ï¸ ì¹˜ë£Œì‚¬</div>
        <div class="ì¹˜ë£Œì‚¬A">ì¹˜ë£Œì‚¬A (í™˜ìO ë“±)</div>
        <div class="ì¹˜ë£Œì‚¬B">ì¹˜ë£Œì‚¬B (í™˜ìWB, í™˜ìRB ë“±)</div>
        <div class="ì¹˜ë£Œì‚¬C">ì¹˜ë£Œì‚¬C (í™˜ìSC, í™˜ìVC ë“±)</div>
        <div class="íŠ¹ë³„ì¹˜ë£Œì‚¬">íŠ¹ë³„ì¹˜ë£Œì‚¬ (í™˜ìDX)</div>

        <div class="section">ğŸ“Š í‘œì‹œ</div>
        <div>â­ = ì²«ë‚´ì›</div>
        <div>C.4/10(4) = Cì½”ìŠ¤ 10íšŒ ì¤‘ 4ì°¨, ì˜¬í•´ 4ë²ˆì§¸</div>
        <div>ë…¹ìƒ‰ í…Œë‘ë¦¬ = ë‹¤íšŒë°©ë¬¸ í™˜ì (3íšŒ+)</div>

        <div class="section">ğŸ”¥ ë‹¤íšŒë°©ë¬¸ TOP</div>
        <div>í™˜ìW (6íšŒ)</div>
        <div>í™˜ìB (6íšŒ)</div>
        <div>í™˜ìR (5íšŒ)</div>
        <div>í™˜ìO (4íšŒ)</div>
    </div>

    <script>
        // ì‹¤ì œ íŒŒì‹±ëœ ë°ì´í„°
        const ptData = {
            "patients": [
                "í™˜ìA", "í™˜ìB", "í™˜ìC", "í™˜ìD", "í™˜ìE", "í™˜ìF", "í™˜ìG",
                "í™˜ìH", "í™˜ìI", "í™˜ìJ", "í™˜ìK", "í™˜ìL", "í™˜ìN", "í™˜ìM",
                "í™˜ìO", "í™˜ìP", "í™˜ìQ", "í™˜ìR", "í™˜ìS", "í™˜ìT", "í™˜ìV",
                "í™˜ìW", "í™˜ìU", "í™˜ìX"
            ],
            "dates": [
                "09/01/2025", "09/04/2025", "09/05/2025", "09/06/2025", "09/08/2025",
                "09/11/2025", "09/12/2025", "09/13/2025", "09/15/2025", "09/18/2025",
                "09/19/2025", "09/20/2025", "09/22/2025"
            ],
            "matrix": {
                "í™˜ìA": {
                    "09/06/2025": {
                        "therapist": "ë¯¸ì •",
                        "time": "10:00",
                        "treatment": "C.8/10(8)",
                        "course": "C",
                        "is_first": false
                    }
                },
                "í™˜ìB": {
                    "09/05/2025": {"therapist": "ë¯¸ì •", "time": "11:30", "treatment": "C.1/10(1)", "course": "C", "is_first": true},
                    "09/08/2025": {"therapist": "ë¯¸ì •", "time": "6:00", "treatment": "C.2/10(2)", "course": "C", "is_first": false},
                    "09/11/2025": {"therapist": "ë¯¸ì •", "time": "11:00", "treatment": "C.3/10(3)", "course": "C", "is_first": false},
                    "09/15/2025": {"therapist": "ë¯¸ì •", "time": "6:30", "treatment": "C.4/10(4)", "course": "C", "is_first": false},
                    "09/18/2025": {"therapist": "ë¯¸ì •", "time": "12:00", "treatment": "C.5/10(5)", "course": "C", "is_first": false},
                    "09/22/2025": {"therapist": "ë¯¸ì •", "time": "7:30", "treatment": "C.4/10(4)", "course": "C", "is_first": false}
                },
                "í™˜ìC": {
                    "09/13/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "1:00", "treatment": "C.38", "course": "C", "is_first": false},
                    "09/19/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "6:30", "treatment": "C.40", "course": "C", "is_first": false}
                },
                "í™˜ìD": {
                    "09/01/2025": {"therapist": "íŠ¹ë³„ì¹˜ë£Œì‚¬", "time": "10:30", "treatment": "C.3", "course": "C", "is_first": false},
                    "09/05/2025": {"therapist": "íŠ¹ë³„ì¹˜ë£Œì‚¬", "time": "10:00", "treatment": "C.4", "course": "C", "is_first": false},
                    "09/22/2025": {"therapist": "íŠ¹ë³„ì¹˜ë£Œì‚¬", "time": "10:30", "treatment": "C.5", "course": "C", "is_first": false}
                },
                "í™˜ìE": {
                    "09/01/2025": {"therapist": "ë¯¸ì •", "time": "7:00", "treatment": "B(C).6/10(7)", "course": "B(C)", "is_first": false}
                },
                "í™˜ìF": {
                    "09/18/2025": {"therapist": "ë¯¸ì •", "time": "7:00", "treatment": "D.1", "course": "D", "is_first": true}
                },
                "í™˜ìG": {
                    "09/22/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "5:30", "treatment": "ë¯¸ìƒ", "course": "ë¯¸ìƒ", "is_first": false}
                },
                "í™˜ìH": {
                    "09/01/2025": {"therapist": "ë¯¸ì •", "time": "11:30", "treatment": "C.6/10(37)", "course": "C", "is_first": false},
                    "09/11/2025": {"therapist": "ë¯¸ì •", "time": "11:40", "treatment": "C.7/10(38)", "course": "C", "is_first": false},
                    "09/12/2025": {"therapist": "ë¯¸ì •", "time": "11:30", "treatment": "C.8/10(39)", "course": "C", "is_first": false},
                    "09/13/2025": {"therapist": "ë¯¸ì •", "time": "9:00", "treatment": "C.9/10(40)", "course": "C", "is_first": false}
                },
                "í™˜ìI": {
                    "09/08/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "7:20", "treatment": "C.1", "course": "C", "is_first": true}
                },
                "í™˜ìJ": {
                    "09/04/2025": {"therapist": "ë¯¸ì •", "time": "4:30", "treatment": "D.V", "course": "D", "is_first": false},
                    "09/11/2025": {"therapist": "ë¯¸ì •", "time": "6:30", "treatment": "D.11", "course": "D", "is_first": false}
                },
                "í™˜ìK": {
                    "09/13/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "10:00", "treatment": "D(H).9/10(21)", "course": "D(H)", "is_first": false},
                    "09/15/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "6:40", "treatment": "D(H).10/10(22)", "course": "D(H)", "is_first": false},
                    "09/22/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "6:30", "treatment": "D(H).1/10(23)", "course": "D(H)", "is_first": true}
                },
                "í™˜ìL": {
                    "09/13/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "11:00", "treatment": "A.5", "course": "A", "is_first": false},
                    "09/20/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "10:00", "treatment": "A.6", "course": "A", "is_first": false}
                },
                "í™˜ìN": {
                    "09/18/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:40", "treatment": "A.6", "course": "A", "is_first": false}
                },
                "í™˜ìM": {
                    "09/08/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "12:00", "treatment": "ì¶©ê²©íŒŒ15.1", "course": "ì¶©ê²©íŒŒ15", "is_first": true}
                },
                "í™˜ìO": {
                    "09/12/2025": {"therapist": "ë¯¸ì •", "time": "6:00", "treatment": "A.22", "course": "A", "is_first": false},
                    "09/13/2025": {"therapist": "ë¯¸ì •", "time": "12:30", "treatment": "A.23", "course": "A", "is_first": false},
                    "09/15/2025": {"therapist": "ë¯¸ì •", "time": "1:00", "treatment": "A.24", "course": "A", "is_first": false},
                    "09/19/2025": {"therapist": "ë¯¸ì •", "time": "12:00", "treatment": "A.25", "course": "A", "is_first": false}
                },
                "í™˜ìP": {
                    "09/11/2025": {"therapist": "ì¹˜ë£Œì‚¬D", "time": "7:30", "treatment": "C.1", "course": "C", "is_first": true},
                    "09/12/2025": {"therapist": "ì¹˜ë£Œì‚¬D", "time": "7:00", "treatment": "D.2", "course": "D", "is_first": false}
                },
                "í™˜ìQ": {
                    "09/18/2025": {"therapist": "ë¯¸ì •", "time": "5:30", "treatment": "D.6", "course": "D", "is_first": false}
                },
                "í™˜ìR": {
                    "09/04/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "2:00", "treatment": "D.1", "course": "D", "is_first": true},
                    "09/12/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:10", "treatment": "D.2", "course": "D", "is_first": false},
                    "09/13/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "11:30", "treatment": "D.3", "course": "D", "is_first": false},
                    "09/18/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "11:00", "treatment": "D3/10(4)", "course": "D", "is_first": false},
                    "09/22/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "12:00", "treatment": "D.", "course": "D", "is_first": false}
                },
                "í™˜ìS": {
                    "09/15/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "10:40", "treatment": "C(D).3/10(3)", "course": "C(D)", "is_first": false},
                    "09/22/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "11:00", "treatment": "C(D).4/10(4)", "course": "C(D)", "is_first": false}
                },
                "í™˜ìT": {
                    "09/04/2025": {"therapist": "ë¯¸ì •", "time": "7:00", "treatment": "C.4", "course": "C", "is_first": false}
                },
                "í™˜ìV": {
                    "09/01/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "12:30", "treatment": "D.12", "course": "D", "is_first": false},
                    "09/06/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "1:00", "treatment": "D.13", "course": "D", "is_first": false},
                    "09/11/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "10:00", "treatment": "C.15", "course": "C", "is_first": false},
                    "09/15/2025": {"therapist": "ì¹˜ë£Œì‚¬C", "time": "12:00", "treatment": "C(D).1/10(17)", "course": "C(D)", "is_first": true}
                },
                "í™˜ìW": {
                    "09/01/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "3:00", "treatment": "B(C).4", "course": "B(C)", "is_first": false},
                    "09/04/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "3:00", "treatment": "C(D).2/5(5)", "course": "C(D)", "is_first": false},
                    "09/15/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:00", "treatment": "C(D).3/5(6)", "course": "C(D)", "is_first": false},
                    "09/18/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:00", "treatment": "C(D).4/5(7)", "course": "C(D)", "is_first": false},
                    "09/19/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:00", "treatment": "C(D).5/5(8)", "course": "C(D)", "is_first": false},
                    "09/22/2025": {"therapist": "ì¹˜ë£Œì‚¬B", "time": "4:00", "treatment": "C(D).5/5(8)", "course": "C(D)", "is_first": false}
                },
                "í™˜ìU": {
                    "09/01/2025": {"therapist": "ë¯¸ì •", "time": "7:30", "treatment": "D.41", "course": "D", "is_first": false}
                },
                "í™˜ìX": {
                    "09/04/2025": {"therapist": "ë¯¸ì •", "time": "4:00", "treatment": "D.30", "course": "D", "is_first": false}
                }
            }
        };

        let filteredData = null;

        // ë‹¤íšŒ ë°©ë¬¸ í™˜ì ì‹ë³„
        function getFrequentPatients() {
            const frequent = [];
            for (const patient in ptData.matrix) {
                if (Object.keys(ptData.matrix[patient]).length >= 3) {
                    frequent.push(patient);
                }
            }
            return frequent;
        }

        // ì¹˜ë£Œì‚¬ í´ë˜ìŠ¤ëª… ì •ê·œí™”
        function getTherapistClass(therapistName) {
            const validClasses = ['ì¹˜ë£Œì‚¬A', 'ì¹˜ë£Œì‚¬B', 'ì¹˜ë£Œì‚¬C', 'ì¹˜ë£Œì‚¬D', 'íŠ¹ë³„ì¹˜ë£Œì‚¬', 'ë¯¸ì •'];
            return validClasses.includes(therapistName) ? therapistName : 'ë¯¸ì •';
        }

        // í…Œì´ë¸” ìƒì„±
        function createTable() {
            const currentData = filteredData || ptData;
            const frequentPatients = getFrequentPatients();

            // í™˜ì ëª©ë¡ ë Œë”ë§
            const patientList = document.getElementById('patient-list');
            patientList.innerHTML = currentData.patients.map(patient => {
                const isFrequent = frequentPatients.includes(patient);
                return `
                    <div class="patient-cell ${isFrequent ? 'frequent' : ''}" onclick="highlightPatient('${patient}')">
                        ${patient}
                    </div>
                `;
            }).join('');

            // ë‚ ì§œ í—¤ë” ë Œë”ë§ (MM/DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜)
            const dateHeader = document.getElementById('dateHeader');
            dateHeader.innerHTML = currentData.dates.map(date => {
                const shortDate = date.substring(5); // MM/DD ë¶€ë¶„ë§Œ
                return `<div class="date-cell">${shortDate}</div>`;
            }).join('');

            // í™˜ìë³„ ë°ì´í„° í–‰ ë Œë”ë§
            const patientRows = document.getElementById('patientRows');
            patientRows.innerHTML = currentData.patients.map(patient => {
                const rowCells = currentData.dates.map(date => {
                    const treatment = ptData.matrix[patient] && ptData.matrix[patient][date];
                    if (treatment) {
                        const therapistClass = getTherapistClass(treatment.therapist);
                        const firstClass = treatment.is_first ? 'first-visit' : '';

                        return `
                            <div class="treatment-cell ${therapistClass} ${firstClass}"
                                 title="${patient}\\n${date} ${treatment.time}\\n${treatment.therapist}\\n${treatment.treatment}">
                                <div class="treatment-text">${treatment.treatment}</div>
                                <div class="time-text">${treatment.time}</div>
                            </div>
                        `;
                    } else {
                        return `<div class="treatment-cell empty"></div>`;
                    }
                }).join('');

                return `<div class="patient-row">${rowCells}</div>`;
            }).join('');
        }

        // í™˜ì ê²€ìƒ‰ ë° í•„í„°
        function filterPatients() {
            const searchTerm = document.getElementById('patientFilter').value.toLowerCase();
            const therapistFilter = document.getElementById('therapistFilter').value;
            const frequentOnly = document.getElementById('frequentOnly').checked;
            const firstVisitOnly = document.getElementById('firstVisitOnly').checked;

            if (!searchTerm && !therapistFilter && !frequentOnly && !firstVisitOnly) {
                filteredData = null;
                createTable();
                return;
            }

            let filteredPatients = ptData.patients;

            // ì´ë¦„ í•„í„°
            if (searchTerm) {
                filteredPatients = filteredPatients.filter(patient =>
                    patient.toLowerCase().includes(searchTerm)
                );
            }

            // ì¹˜ë£Œì‚¬ í•„í„°
            if (therapistFilter) {
                filteredPatients = filteredPatients.filter(patient => {
                    const visits = ptData.matrix[patient] || {};
                    return Object.values(visits).some(visit => visit.therapist === therapistFilter);
                });
            }

            // ë‹¤íšŒë°©ë¬¸ í•„í„°
            if (frequentOnly) {
                filteredPatients = filteredPatients.filter(patient => {
                    const visits = ptData.matrix[patient] || {};
                    return Object.keys(visits).length >= 3;
                });
            }

            // ì²«ë‚´ì› í•„í„°
            if (firstVisitOnly) {
                filteredPatients = filteredPatients.filter(patient => {
                    const visits = ptData.matrix[patient] || {};
                    return Object.values(visits).some(visit => visit.is_first);
                });
            }

            filteredData = {
                patients: filteredPatients,
                dates: ptData.dates
            };

            createTable();
        }

        // í™˜ì í•˜ì´ë¼ì´íŠ¸
        function highlightPatient(patientName) {
            // ëª¨ë“  í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.patient-cell').forEach(cell => {
                cell.style.backgroundColor = '';
            });
            document.querySelectorAll('.patient-row').forEach(row => {
                row.style.backgroundColor = '';
            });

            // ì„ íƒëœ í™˜ì í•˜ì´ë¼ì´íŠ¸
            const cells = document.querySelectorAll('.patient-cell');
            const rows = document.querySelectorAll('.patient-row');

            cells.forEach((cell, index) => {
                if (cell.textContent.trim() === patientName) {
                    cell.style.backgroundColor = '#fffacd';
                    if (rows[index]) {
                        rows[index].style.backgroundColor = '#fffacd';
                    }
                }
            });
        }

        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
        document.addEventListener('keydown', function(e) {
            const scrollAmount = 180;
            const dataScroll = document.getElementById('dataScroll');

            switch(e.key) {
                case 'ArrowLeft':
                    dataScroll.scrollLeft -= scrollAmount;
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    dataScroll.scrollLeft += scrollAmount;
                    e.preventDefault();
                    break;
                case 'Home':
                    dataScroll.scrollLeft = 0;
                    e.preventDefault();
                    break;
                case 'End':
                    dataScroll.scrollLeft = dataScroll.scrollWidth;
                    e.preventDefault();
                    break;
            }
        });

        // ë§ˆìš°ìŠ¤ íœ  ê°€ë¡œ ìŠ¤í¬ë¡¤
        document.getElementById('dataScroll').addEventListener('wheel', function(e) {
            if (e.shiftKey) {
                e.preventDefault();
                this.scrollLeft += e.deltaY;
            }
        });

        // ì´ˆê¸°í™”
        createTable();

        console.log('âœ… ì‹¤ì œ í™˜ì ë§¤íŠ¸ë¦­ìŠ¤ ë¡œë”© ì™„ë£Œ!');
        console.log(`ğŸ“Š í™˜ì ${ptData.patients.length}ëª…, ë‚ ì§œ ${ptData.dates.length}ì¼, ë‹¤íšŒë°©ë¬¸ ${getFrequentPatients().length}ëª…`);
        console.log('ğŸ® ì‚¬ìš©ë²•: ì¢Œìš° í™”ì‚´í‘œë¡œ ìŠ¤í¬ë¡¤, í™˜ìëª… í´ë¦­ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸, í•„í„°ë¡œ ê²€ìƒ‰');
    </script>
</body>
</html>